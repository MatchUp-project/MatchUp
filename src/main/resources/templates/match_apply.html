<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>매치 신청 | Match-Up</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- 기존 전역 css (프로젝트에서 쓰던 거 유지) -->
    <link rel="stylesheet" th:href="@{/styles.css}"/>

    <style>
        /* ====== 잔디 배경 + 기본 레이아웃 (2번 페이지와 동일) ====== */
        body {
            margin: 0;
            min-height: 100vh;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", sans-serif;
            color: #111827;
            display: flex;
            justify-content: center;
            padding: 48px 16px 64px;
            background:
                    linear-gradient(180deg, rgba(15,23,42,0.25), rgba(15,23,42,0.4)),
                    url("/images/pitch-bg.png") center/cover no-repeat fixed;
        }

        .match-page {
            width: 100%;
            max-width: 1120px;
        }

        /* ====== 상단 타이틀 (2번이랑 같은 스타일) ====== */
        .match-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
            color: #f9fafb;
            text-shadow: 0 2px 4px rgba(15, 23, 42, 0.9);
        }

        .match-header-left {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .match-title {
            font-size: 22px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .match-title-icon {
            width: 28px;
            height: 28px;
            border-radius: 999px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: radial-gradient(circle at 30% 30%, #ffffff, #9ca3af);
            box-shadow: 0 6px 12px rgba(0,0,0,0.65);
            font-size: 15px;
        }

        .match-subtitle {
            font-size: 13px;
            opacity: 0.9;
        }

        .match-header-right {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .my-team-pill {
            padding: 6px 14px;
            border-radius: 999px;
            font-size: 12px;
            background: rgba(15,23,42,0.8);
            color: #e5e7eb;
            border: 1px solid rgba(148,163,184,0.8);
            box-shadow: 0 4px 10px rgba(0,0,0,0.6);
        }

        /* ====== 유리 카드 공통 (2번 표 느낌 그대로) ====== */
        .glass-card {
            background: rgba(243, 244, 246, 0.88);
            backdrop-filter: blur(8px);
            border-radius: 18px;
            border: 1px solid rgba(148, 163, 184, 0.8);
            box-shadow: 0 12px 32px rgba(15, 23, 42, 0.7);
        }

        /* ====== 매치 등록 카드 ====== */
        .match-register-card {
            padding: 18px 22px 20px;
            margin-bottom: 18px;
        }

        .match-register-title {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        /* ====== 탭 버튼 (가능 / 불가능) ====== */
        .match-tab-group {
            display: inline-flex;
            border-radius: 999px;
            padding: 3px;
            background: rgba(15,23,42,0.85);
            box-shadow: 0 10px 24px rgba(15,23,42,0.7);
            margin-bottom: 14px;
        }

        .match-tab-group a {
            border-radius: 999px !important;
            border: none !important;
            font-size: 13px;
            padding: 6px 16px;
            color: #e5e7eb;
            background: transparent;
        }

        .match-tab-group a.active-tab {
            background: linear-gradient(135deg, #2563eb, #22c55e);
            color: #f9fafb;
            box-shadow: 0 4px 10px rgba(0,0,0,0.7);
        }

        /* ====== 섹션 제목 ====== */
        .match-section-title {
            font-size: 15px;
            font-weight: 600;
            color: #f9fafb;
            text-shadow: 0 2px 4px rgba(0,0,0,0.9);
            margin-bottom: 8px;
        }

        .match-empty-text {
            font-size: 13px;
            color: #e5e7eb;
            text-shadow: 0 1px 3px rgba(0,0,0,0.9);
            margin-bottom: 12px;
        }

        /* ====== 매치 카드 리스트 (2번 표 느낌의 반투명 카드) ====== */
        .match-card {
            background: rgba(255, 255, 255, 0.35);
            backdrop-filter: blur(6px);
            border-radius: 14px;
            border: 1px solid rgba(148, 163, 184, 0.8);
            box-shadow: 0 8px 22px rgba(15,23,42,0.75);
            color: #0f172a;
        }

        .match-card + .match-card {
            margin-top: 10px;
        }

        .match-card .team-name {
            font-weight: 600;
            font-size: 15px;
        }

        .match-meta {
            font-size: 13px;
            color: #4b5563;
        }

        .match-card.matched {
            opacity: 0.5;
        }

        .match-status-text {
            font-size: 13px;
        }

        /* 오른쪽 액션 버튼 영역 */
        .match-card-actions form button {
            font-size: 13px;
            padding: 6px 14px;
            border-radius: 999px;
        }

        /* ====== 메인으로 버튼 (2번 페이지와 동일 느낌) ====== */
        .btn-main {
            border-radius: 999px;
            font-size: 12px;
            padding: 6px 16px;
            margin-top: 18px;
            border-color: #e5e7eb;
            color: #f9fafb;
            background: rgba(15, 23, 42, 0.7);
            box-shadow: 0 4px 12px rgba(0,0,0,0.6);
        }

        .btn-main:hover {
            background: #111827;
        }
    </style>
</head>
<body>

<div class="match-page">

    <!-- ===== 상단 헤더 ===== -->
    <div class="match-header">
        <div class="match-header-left">
            <div class="match-title">
                <span class="match-title-icon">⚽</span>
                <span>매치 신청</span>
            </div>
            <div class="match-subtitle">
                내 팀의 매치를 등록하고, 다른 팀과 매칭해 보세요.
            </div>
        </div>

        <div class="match-header-right" th:if="${!noTeam}">
            <div class="my-team-pill">
                내 팀 :
                <span th:text="${team != null ? team.name : '팀 이름'}">팀 이름</span>
            </div>
        </div>
    </div>

    <!-- 팀이 없을 때 -->
    <div th:if="${noTeam}" class="glass-card p-3 mb-3">
        <div class="text-danger fw-semibold mb-1">팀이 없습니다</div>
        <div class="small text-muted">
            팀을 먼저 생성하거나, 다른 팀에 가입해야 매치를 등록할 수 있습니다.
        </div>
    </div>

    <!-- 팀이 있을 때 -->
    <div th:unless="${noTeam}">

        <!-- 매치 등록 폼 -->
        <div class="glass-card match-register-card">
            <div class="match-register-title">새로운 매치 등록</div>

            <form th:action="@{/match/create}" method="post" th:object="${matchCreateForm}">
                <div class="row g-3">
                    <div class="col-md-3">
                        <label class="form-label">팀 이름</label>
                        <input type="text" class="form-control"
                               th:value="${team != null ? team.name : '팀 이름'}" readonly>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">인원 수</label>
                        <input type="number" class="form-control"
                               th:field="*{playerCount}" min="1" required>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">경기장 위치</label>
                        <input type="text" class="form-control"
                               th:field="*{location}" required>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">날짜</label>
                        <input type="date" class="form-control"
                               th:field="*{date}" required>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">시간</label>
                        <input type="time" class="form-control"
                               th:field="*{time}" required>
                    </div>
                </div>
                <div class="mt-3 text-end">
                    <button type="submit" class="btn btn-primary px-4">
                        매치 등록
                    </button>
                </div>
            </form>
        </div>

        <!-- ===== 탭 버튼 (가능 / 불가능) ===== -->
        <div class="match-tab-group">
            <a th:href="@{/match/apply(filter='available')}"
               th:classappend="${filter} == 'available' ? ' active-tab' : ''"
               class="btn">
                매치 신청 가능
            </a>
            <a th:href="@{/match/apply(filter='unavailable')}"
               th:classappend="${filter} == 'unavailable' ? ' active-tab' : ''"
               class="btn">
                매치 신청 불가능
            </a>
        </div>

        <!-- 제목 -->
        <div class="match-section-title"
             th:text="${filter} == 'available' ? '매치 신청 가능 목록' : '매치 신청 불가능 목록'">
            매치 신청 목록
        </div>

        <!-- 비어 있을 때 메시지 -->
        <div th:if="${#lists.isEmpty(matchPosts)}" class="match-empty-text">
            <span th:text="${filter} == 'available'
                           ? '현재 신청 가능한 매치가 없습니다.'
                           : '현재 신청 불가능한 매치가 없습니다.'">
                목록이 없습니다.
            </span>
        </div>

        <!-- 매치 리스트 -->
        <div th:each="post : ${matchPosts}" class="mb-2">
            <div class="match-card"
                 th:classappend="${post.status == 'MATCHED'} ? ' matched' : ''">
                <div class="card-body d-flex justify-content-between align-items-center">

                    <!-- 왼쪽: 매치 정보 -->
                    <div>
                        <div class="mb-1">
                            <span class="team-name" th:text="${post.team.name}">팀 이름</span>
                            <span class="text-muted ms-2 match-meta">
                                인원수: <span th:text="${post.playerCount}">0</span>명
                            </span>
                        </div>
                        <div class="match-meta">
                            장소:
                            <span th:text="${post.location}">장소</span><br>
                            일시:
                            <span th:text="${#temporals.format(post.matchDatetime, 'yyyy-MM-dd HH:mm')}">
                                2025-03-28 09:40
                            </span>
                        </div>
                    </div>

                    <!-- 오른쪽: filter 에 따라 다른 UI -->
                    <div class="text-end match-card-actions" th:switch="${filter}">

                        <!-- ===== 매치 신청 가능 탭 ===== -->
                        <div th:case="'available'">
                            <form th:action="@{'/match/' + ${post.id} + '/request'}"
                                  method="post">
                                <button type="submit" class="btn btn-outline-primary">
                                    매치 신청
                                </button>
                            </form>
                        </div>

                        <!-- ===== 매치 신청 불가능 탭 ===== -->
                        <div th:case="'unavailable'">

                            <!-- 이미 매치 완료 -->
                            <div th:if="${post.status == 'MATCHED'}"
                                 class="text-danger fw-semibold mb-2 match-status-text">
                                이미 매치가 완료됐습니다
                            </div>

                            <!-- 내가 신청한 매치: PENDING -->
                            <div th:if="${post.status == 'OPEN'
                                         and post.createdBy != null
                                         and post.createdBy.id != currentUser.id
                                         and requestStatusMap[post.id] == 'PENDING'}"
                                 class="text-primary fw-semibold mb-2 match-status-text">
                                매치 신청 완료됐습니다
                            </div>

                            <!-- 내가 신청한 매치: REJECTED -->
                            <div th:if="${post.status == 'OPEN'
                                         and post.createdBy != null
                                         and post.createdBy.id != currentUser.id
                                         and requestStatusMap[post.id] == 'REJECTED'}"
                                 class="text-danger fw-semibold mb-2 match-status-text">
                                매치 신청이 거절되었습니다
                            </div>

                            <!-- 내가 올린 매치(OPEN 상태) -->
                            <div th:if="${post.status == 'OPEN'
                                         and post.createdBy != null
                                         and post.createdBy.id == currentUser.id}">
                                <span class="badge bg-secondary mb-2 d-block">
                                    내가 등록한 매치
                                </span>

                                <form th:action="@{'/match/' + ${post.id} + '/delete'}"
                                      method="post"
                                      onsubmit="return confirm('정말 이 매치를 삭제하시겠습니까?');">
                                    <button type="submit" class="btn btn-outline-danger btn-sm">
                                        매치 삭제
                                    </button>
                                </form>
                            </div>

                        </div><!-- /unavailable -->

                    </div><!-- /text-end -->

                </div><!-- /card-body -->
            </div>
        </div><!-- /each matchPosts -->

    </div><!-- /팀 있을 때 -->

    <a href="/" class="btn btn-outline-secondary btn-main">메인으로</a>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
