<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      th:replace="fragments/layout :: layout(~{::content})">
<div th:fragment="content">
    <div class="container" style="max-width: 620px;">
        <div class="card-box">
            <div class="card-header">
                <div>
                    <div class="text-muted small">팀</div>
                    <h4 class="fw-bold m-0">팀 생성</h4>
                </div>
            </div>

            <div class="pt-3">
                <form id="teamForm">
                    <div class="mb-3">
                        <label class="form-label fw-semibold">팀 이름</label>
                        <input type="text" class="form-control" id="name" placeholder="예: MATCH-UP FC" required>
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-semibold">지역</label>
                        <select class="form-select" id="region" required>
                            <option value="">지역 선택</option>
                            <option value="SEOUL">서울</option>
                            <option value="GYEONGGI">경기</option>
                            <option value="INCHEON">인천</option>
                            <option value="BUSAN">부산</option>
                            <option value="DAEGU">대구</option>
                            <option value="DAEJEON">대전</option>
                            <option value="GWANGJU">광주</option>
                            <option value="ULSAN">울산</option>
                            <option value="SEJONG">세종</option>
                            <option value="GANGWON">강원</option>
                            <option value="CHUNGBUK">충북</option>
                            <option value="CHUNGNAM">충남</option>
                            <option value="JEONBUK">전북</option>
                            <option value="JEONNAM">전남</option>
                            <option value="GYEONGBUK">경북</option>
                            <option value="GYEONGNAM">경남</option>
                            <option value="JEJU">제주</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-semibold">소개</label>
                        <textarea class="form-control" id="intro" rows="4" placeholder="팀 소개를 입력하세요."></textarea>
                    </div>

                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary">생성</button>
                        <a href="/team_list" class="btn btn-outline-secondary">취소</a>
                    </div>
                    <div class="text-danger mt-3" id="errorMsg"></div>
                </form>
            </div>
        </div>
    </div>

    <script>
        const form = document.getElementById('teamForm');
        form.addEventListener('submit', function (e) {
            e.preventDefault();
            createTeam();
        });

        function createTeam() {
            const name = document.getElementById('name').value.trim();
            const region = document.getElementById('region').value.trim();
            const intro = document.getElementById('intro').value.trim();
            const errorMsg = document.getElementById('errorMsg');

            errorMsg.textContent = '';

            if (!name) {
                errorMsg.textContent = '팀 이름을 입력해주세요.';
                return;
            }
            if (!region) {
                errorMsg.textContent = '지역을 선택해주세요.';
                return;
            }

            fetch('/api/teams', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name, region, intro })
            })
                .then(res => {
                    if (!res.ok) throw new Error('fail');
                    return res.json();
                })
                .then(data => {
                    window.location.href = '/team/detail/' + data.id;
                })
                .catch(() => {
                    errorMsg.textContent = '팀 생성에 실패했습니다. 다시 시도해주세요.';
                });
        }
    </script>
</div>
</html>
