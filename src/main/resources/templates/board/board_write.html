<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>게시글 작성</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<!-- 상단 유틸 바 -->
<div class="bg-dark text-white small py-1">
    <div class="container d-flex justify-content-end gap-3">
        <a href="/" class="link-light text-decoration-none">홈</a>
        <a href="/profile" class="link-light text-decoration-none">내 정보</a>
        <a href="/logout" class="link-light text-decoration-none">로그아웃</a>
    </div>
</div>

<!-- 헤더 + 검색 -->
<header class="border-bottom">
    <div class="container py-3 d-flex align-items-center justify-content-between">
        <a class="navbar-brand fw-bold fs-3 text-primary" href="/">Match-Up</a>

        <form class="d-flex w-50" role="search">
            <input class="form-control form-control-lg rounded-start-pill"
                   type="search" placeholder="팀, 구장, 지역 검색">
            <button class="btn btn-primary btn-lg rounded-end-pill px-4">
                <i class="bi bi-search"></i>
            </button>
        </form>

        <button class="btn btn-outline-secondary">
            <i class="bi bi-list"></i> 메뉴
        </button>
    </div>
</header>
<div class="container py-5">

    <h3>✏ 게시글 작성</h3>

    <form id="boardForm">

        <!-- 카테고리 선택 -->
        <div class="mb-3">
            <label class="form-label">카테고리</label>
            <select class="form-select" name="category" id="category">
                <option value="FREE">자유게시판</option>
                <option value="PLAYER">선수모집</option>
                <option value="TEAM">팀구함</option>
            </select>
        </div>

        <!-- 공통 제목 -->
        <div class="mb-3">
            <label class="form-label">제목</label>
            <input type="text" class="form-control" name="title" required>
        </div>

        <!-- 공통 내용 -->
        <div class="mb-3">
            <label class="form-label">내용</label>
            <textarea class="form-control" rows="8" name="content" required></textarea>
        </div>

        <!-- 선수모집 전용 -->
        <div id="playerFields" class="d-none">

            <div class="mb-3">
                <label class="form-label">포지션</label>
                <select name="positionNeeded" class="form-select">
                    <option value="FW">FW</option>
                    <option value="MF">MF</option>
                    <option value="DF">DF</option>
                    <option value="GK">GK</option>
                </select>
            </div>

            <div class="mb-3">
                <label class="form-label">나이대</label>
                <input type="text" class="form-control" name="ageRange" placeholder="예: 20~30">
            </div>

            <div class="mb-3">
                <label class="form-label">실력</label>
                <select name="skillLevel" class="form-select">
                    <option value="초급">초급</option>
                    <option value="중급">중급</option>
                    <option value="상급">상급</option>
                </select>
            </div>

        </div>

        <!-- 팀구함 전용 -->
        <div id="teamFields" class="d-none">

            <div class="mb-3">
                <label class="form-label">지역</label>
                <input type="text" class="form-control" name="region" placeholder="예: 서울/대구/청주">
            </div>

            <div class="mb-3">
                <label class="form-label">선호 포지션</label>
                <select name="preferredPosition" class="form-select">
                    <option value="FW">FW</option>
                    <option value="MF">MF</option>
                    <option value="DF">DF</option>
                    <option value="GK">GK</option>
                </select>
            </div>

            <div class="mb-3">
                <label class="form-label">실력</label>
                <select name="skillLevel" class="form-select">
                    <option value="초급">초급</option>
                    <option value="중급">중급</option>
                    <option value="상급">상급</option>
                </select>
            </div>

        </div>

        <button type="submit" class="btn btn-primary">등록</button>
        <a href="/board" class="btn btn-secondary">취소</a>

    </form>

</div>


<script>
    const categorySelect = document.getElementById('category');
    const playerFields = document.getElementById('playerFields');
    const teamFields = document.getElementById('teamFields');

    // 카테고리 변경 시 입력창 노출 변경
    categorySelect.addEventListener('change', toggleFields);

    function toggleFields() {
        const value = categorySelect.value;

        playerFields.classList.add('d-none');
        teamFields.classList.add('d-none');

        if (value === 'PLAYER') playerFields.classList.remove('d-none');
        if (value === 'TEAM') teamFields.classList.remove('d-none');
    }

    toggleFields(); // 초기 실행


    // 🔥 폼 제출(fetch) 처리
    const form = document.getElementById('boardForm');

    form.addEventListener('submit', function(e) {
        e.preventDefault();

        const formData = new FormData(form);
        const data = Object.fromEntries(formData.entries());

        fetch('/api/board', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        })
        .then(res => res.text())
        .then(id => {
            alert('작성 완료!');
            location.href = '/board/' + id;
        });
    });
</script>

</body>
</html>
