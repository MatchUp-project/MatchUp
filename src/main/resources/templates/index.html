<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>MatchUp 팀 목록</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f5f5f5; }
        h1 { margin-bottom: 10px; }
        .container { max-width: 900px; margin: 0 auto; }
        .team-list { margin-top: 20px; }
        .team-card {
            background: #ffffff; border-radius: 8px; padding: 12px 16px;
            margin-bottom: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .team-card .name { font-weight: bold; font-size: 18px; }
        .team-card .region { color: #666; font-size: 14px; }
        .team-card .intro { margin-top: 6px; font-size: 14px; }
        .form-box {
            background: #ffffff; border-radius: 8px; padding: 16px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        label { display: block; margin-top: 10px; font-size: 14px; }
        input[type="text"], textarea {
            width: 100%; box-sizing: border-box; padding: 8px; margin-top: 4px;
        }
        button {
            margin-top: 15px; padding: 8px 16px; border: none; border-radius: 4px;
            background: #4CAF50; color: white; cursor: pointer;
        }
        button:disabled { background: #aaa; }
        .error { color: red; margin-top: 8px; }
        .empty { color: #666; margin-top: 10px; }
    </style>
</head>
<body>
<div class="container">
    <h1>MatchUp 팀 관리</h1>
    <div style="margin-bottom: 10px; font-size: 14px;">
        <button onclick="location.href='/stadiums'">경기장 관리</button>
    </div>


    <div class="form-box">
        <h2>새 팀 만들기</h2>
        <label>
            팀 이름
            <input type="text" id="name" placeholder="예: 서울 타이거즈">
        </label>

        <label>
            지역
            <input type="text" id="region" placeholder="예: 서울">
        </label>

        <label>
            팀 소개
            <textarea id="intro" rows="3" placeholder="팀 소개를 적어주세요"></textarea>
        </label>

        <label>
            리더 ID (선택)
            <input type="text" id="leaderId" placeholder="users 테이블의 id (모르면 비워두기)">
        </label>

        <button id="createBtn">팀 생성</button>
        <div class="error" id="errorMsg"></div>
    </div>

    <div class="team-list">
        <h2>팀 목록</h2>
        <div id="teamsContainer"></div>
    </div>
</div>

<script>
    const API_BASE = '/api/teams';

    async function loadTeams() {
        const container = document.getElementById('teamsContainer');
        container.innerHTML = '불러오는 중...';

        try {
            const res = await fetch(API_BASE);
            if (!res.ok) throw new Error('서버 오류: ' + res.status);
            const data = await res.json();

            if (data.length === 0) {
                container.innerHTML = '<div class="empty">등록된 팀이 없습니다.</div>';
                return;
            }

            container.innerHTML = '';
            data.forEach(team => {
    const div = document.createElement('div');
    div.className = 'team-card';
    div.innerHTML = `
    <div class="name">${team.name}</div>
    <div class="region">${team.region || '지역 정보 없음'}</div>
    <div class="intro">${team.intro || ''}</div>
    <div style="margin-top:4px; font-size:12px; color:#999;">
        리더 ID: ${team.leaderId ?? '없음'} / 생성일: ${team.createdAt}
    </div>
    <div style="margin-top:8px; display:flex; gap:8px; flex-wrap:wrap;">
        <button onclick="location.href='/board?teamId=${team.id}&teamName=${encodeURIComponent(team.name)}'">
            게시판 가기
        </button>
        <button onclick="location.href='/events?teamId=${team.id}&teamName=${encodeURIComponent(team.name)}'">
            일정 보기
        </button>
        <button onclick="location.href='/members?teamId=${team.id}&teamName=${encodeURIComponent(team.name)}'">
            팀원 관리
        </button>
        <button onclick="location.href='/matches?teamId=${team.id}&teamName=${encodeURIComponent(team.name)}'">
            경기 기록
        </button>
        <button onclick="location.href='/media?teamId=${team.id}&teamName=${encodeURIComponent(team.name)}'">
            미디어
        </button>
        <button onclick="location.href='/chat-rooms?teamId=${team.id}&teamName=${encodeURIComponent(team.name)}'">
            채팅방
        </button>
    </div>
`;





    container.appendChild(div);
});


        } catch (e) {
            container.innerHTML = '<div class="error">팀 목록을 불러오는 중 오류가 발생했습니다.</div>';
            console.error(e);
        }
    }

    async function createTeam() {
        const nameEl = document.getElementById('name');
        const regionEl = document.getElementById('region');
        const introEl = document.getElementById('intro');
        const leaderIdEl = document.getElementById('leaderId');
        const errorMsg = document.getElementById('errorMsg');
        const btn = document.getElementById('createBtn');

        errorMsg.textContent = '';

        if (!nameEl.value.trim()) {
            errorMsg.textContent = '팀 이름은 필수입니다.';
            return;
        }

        const body = {
            name: nameEl.value.trim(),
            region: regionEl.value.trim(),
            intro: introEl.value.trim(),
            leaderId: leaderIdEl.value.trim() ? Number(leaderIdEl.value.trim()) : null
        };

        btn.disabled = true;

        try {
            const res = await fetch(API_BASE, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(body)
            });

            if (!res.ok) {
                const txt = await res.text();
                throw new Error('생성 실패: ' + txt);
            }

            nameEl.value = '';
            regionEl.value = '';
            introEl.value = '';
            leaderIdEl.value = '';

            await loadTeams();

        } catch (e) {
            errorMsg.textContent = '팀 생성 중 오류: ' + e.message;
            console.error(e);
        } finally {
            btn.disabled = false;
        }
    }

    document.getElementById('createBtn').addEventListener('click', createTeam);
    window.addEventListener('load', loadTeams);
</script>
</body>
</html>
