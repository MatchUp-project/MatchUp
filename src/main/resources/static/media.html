<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>팀 미디어 갤러리</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f5f5f5; }
        .container { max-width: 1000px; margin: 0 auto; }
        a { text-decoration: none; color: #007bff; }
        h1 { margin-bottom: 10px; }

        .form-box {
            background: #ffffff; border-radius: 8px; padding: 16px;
            margin-bottom: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        label { display: block; margin-top: 8px; font-size: 14px; }
        input[type="text"], input[type="number"] {
            width: 100%; box-sizing: border-box; padding: 8px; margin-top: 4px;
        }
        select { padding: 6px; margin-top: 4px; }

        button {
            margin-top: 12px; padding: 8px 16px; border: none; border-radius: 4px;
            background: #4CAF50; color: #fff; cursor: pointer;
        }
        button.small { padding: 4px 8px; font-size: 12px; }
        button.danger { background: #e74c3c; }
        button:disabled { background: #aaa; }

        .error { color: red; margin-top: 6px; }
        .empty { color: #666; margin-top: 10px; }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 12px;
        }
        .media-card {
            background: #ffffff; border-radius: 8px; padding: 10px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            display: flex; flex-direction: column; gap: 6px;
        }
        .media-preview img,
        .media-preview video {
            max-width: 100%;
            border-radius: 6px;
        }
        .media-info { font-size: 12px; color: #555; word-break: break-all; }
        .badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 11px;
            background: #eee;
            margin-right: 4px;
        }
        .badge-image { background: #3498db; color: #fff; }
        .badge-video { background: #e67e22; color: #fff; }
    </style>
</head>
<body>
<div class="container">
    <a href="/">← 팀 목록으로</a>
    <h1 id="title">팀 미디어 갤러리</h1>

    <div class="form-box">
        <h2>새 미디어 추가</h2>
        <p style="font-size:13px; color:#555;">
            실제 파일 업로드 대신, 일단은 이미지/영상의 <b>URL</b>을 저장하는 방식으로 구현해두었어.<br>
            (나중에 진짜 파일 업로드 기능으로 확장 가능)
        </p>

        <label>
            업로더 ID (users.id)
            <input type="number" id="uploaderId" placeholder="예: 1">
        </label>

        <label>
            파일 URL (이미지 또는 영상)
            <input type="text" id="fileUrl" placeholder="예: https://.../image.jpg 또는 https://.../video.mp4">
        </label>

        <label>
            타입
            <select id="mediaType">
                <option value="IMAGE" selected>IMAGE (이미지)</option>
                <option value="VIDEO">VIDEO (영상)</option>
            </select>
        </label>

        <button id="addBtn">추가</button>
        <div class="error" id="errorMsg"></div>
    </div>

    <h2>미디어 목록</h2>
    <div id="mediaContainer"></div>
</div>

<script>
    const params = new URLSearchParams(location.search);
    const teamId = Number(params.get('teamId'));
    const teamName = params.get('teamName') || '팀';

    document.getElementById('title').textContent = teamName + ' 미디어 갤러리';

    const API_BASE = '/api/media';

    function formatDateTime(str) {
        if (!str) return '-';
        return str.replace('T', ' ');
    }

    async function loadMedia() {
        const container = document.getElementById('mediaContainer');
        container.innerHTML = '불러오는 중...';

        try {
            const res = await fetch(API_BASE + '?teamId=' + teamId);
            if (!res.ok) throw new Error('서버 오류: ' + res.status);
            const data = await res.json();

            if (data.length === 0) {
                container.innerHTML = '<div class="empty">등록된 미디어가 없습니다.</div>';
                return;
            }

            const grid = document.createElement('div');
            grid.className = 'grid';

            data.forEach(m => {
                const card = document.createElement('div');
                card.className = 'media-card';

                const preview = document.createElement('div');
                preview.className = 'media-preview';

                if (m.type === 'IMAGE') {
                    preview.innerHTML = `<img src="${m.fileUrl}" alt="image">`;
                } else if (m.type === 'VIDEO') {
                    preview.innerHTML = `<video controls src="${m.fileUrl}"></video>`;
                }

                const info = document.createElement('div');
                info.className = 'media-info';
                info.innerHTML = `
                    <div>
                        <span class="badge ${m.type === 'IMAGE' ? 'badge
