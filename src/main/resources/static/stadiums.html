<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>경기장 관리</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f5f5f5; }
        .container { max-width: 1000px; margin: 0 auto; }
        a { text-decoration: none; color: #007bff; }
        h1 { margin-bottom: 10px; }

        .form-box {
            background: #ffffff; border-radius: 8px; padding: 16px;
            margin-bottom: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        label { display: block; margin-top: 8px; font-size: 14px; }
        input[type="text"], input[type="number"] {
            width: 100%; box-sizing: border-box; padding: 8px; margin-top: 4px;
        }
        select { padding: 6px; margin-top: 4px; }

        button {
            margin-top: 12px; padding: 8px 16px; border: none; border-radius: 4px;
            background: #4CAF50; color: #fff; cursor: pointer;
        }
        button.small { padding: 4px 8px; font-size: 12px; }
        button.danger { background: #e74c3c; }
        button:disabled { background: #aaa; }

        .error { color: red; margin-top: 6px; }
        .empty { color: #666; margin-top: 10px; }

        table {
            width: 100%;
            border-collapse: collapse;
            background: #ffffff;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        th, td {
            padding: 8px 10px;
            border-bottom: 1px solid #eee;
            font-size: 13px;
        }
        th { background: #f0f0f0; text-align: left; }
        tr:last-child td { border-bottom: none; }
        .tag-yes { color: #2ecc71; font-weight: bold; }
        .tag-no { color: #e74c3c; font-weight: bold; }
    </style>
</head>
<body>
<div class="container">
    <a href="/">← 팀 목록으로</a>
    <h1>경기장 관리</h1>

    <div class="form-box">
        <h2>새 경기장 등록</h2>
        <label>
            이름
            <input type="text" id="name" placeholder="예: 잠실야구장">
        </label>
        <label>
            주소
            <input type="text" id="address" placeholder="예: 서울시 송파구 ...">
        </label>
        <label>
            지역
            <input type="text" id="region" placeholder="예: 서울">
        </label>
        <label>
            수용 인원
            <input type="number" id="capacity" placeholder="예: 25000">
        </label>
        <label>
            구장 표면 (잔디 등)
            <input type="text" id="surface" placeholder="예: 천연잔디">
        </label>
        <label>
            전화번호
            <input type="text" id="phone" placeholder="예: 02-123-4567">
        </label>
        <label>
            사용 가능 여부
            <select id="isAvailable">
                <option value="true" selected>사용 가능</option>
                <option value="false">사용 불가</option>
            </select>
        </label>

        <button id="saveBtn">경기장 저장</button>
        <div class="error" id="errorMsg"></div>
    </div>

    <h2>경기장 목록</h2>
    <div id="stadiumContainer"></div>
</div>

<script>
    const API_BASE = '/api/stadiums';

    async function loadStadiums() {
        const container = document.getElementById('stadiumContainer');
        container.innerHTML = '불러오는 중...';

        try {
            const res = await fetch(API_BASE);
            if (!res.ok) throw new Error('서버 오류: ' + res.status);
            const data = await res.json();

            if (data.length === 0) {
                container.innerHTML = '<div class="empty">등록된 경기장이 없습니다.</div>';
                return;
            }

            let html = `
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>이름</th>
                            <th>지역</th>
                            <th>수용 인원</th>
                            <th>표면</th>
                            <th>전화</th>
                            <th>사용 가능</th>
                            <th>삭제</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            data.forEach(s => {
                html += `
                    <tr>
                        <td>${s.id}</td>
                        <td>${s.name}</td>
                        <td>${s.region || '-'}</td>
                        <td>${s.capacity ?? '-'}</td>
                        <td>${s.surface || '-'}</td>
                        <td>${s.phone || '-'}</td>
                        <td>
                            <span class="${s.isAvailable ? 'tag-yes' : 'tag-no'}">
                                ${s.isAvailable ? '가능' : '불가'}
                            </span>
                        </td>
                        <td>
                            <button class="small danger" onclick="deleteStadium(${s.id})">삭제</button>
                        </td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            container.innerHTML = html;

        } catch (e) {
            container.innerHTML = '<div class="error">경기장 목록을 불러오는 중 오류가 발생했습니다.</div>';
            console.error(e);
        }
    }

    async function saveStadium() {
        const nameEl = document.getElementById('name');
        const addressEl = document.getElementById('address');
        const regionEl = document.getElementById('region');
        const capacityEl = document.getElementById('capacity');
        const surfaceEl = document.getElementById('surface');
        const phoneEl = document.getElementById('phone');
        const availEl = document.getElementById('isAvailable');
        const errorMsg = document.getElementById('errorMsg');
        const btn = document.getElementById('saveBtn');

        errorMsg.textContent = '';

        if (!nameEl.value.trim()) {
            errorMsg.textContent = '이름은 필수입니다.';
            return;
        }

        const capacityRaw = capacityEl.value.trim();
        const capacity = capacityRaw ? Number(capacityRaw) : null;
        if (capacityRaw && Number.isNaN(capacity)) {
            errorMsg.textContent = '수용 인원은 숫자로 입력해야 합니다.';
            return;
        }

        const body = {
            name: nameEl.value.trim(),
            address: addressEl.value.trim(),
            region: regionEl.value.trim(),
            capacity: capacity,
            surface: surfaceEl.value.trim(),
            phone: phoneEl.value.trim(),
            isAvailable: availEl.value === 'true'
        };

        btn.disabled = true;

        try {
            const res = await fetch(API_BASE, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(body)
            });
            if (!res.ok) {
                const txt = await res.text();
                throw new Error(txt);
            }

            nameEl.value = '';
            addressEl.value = '';
            regionEl.value = '';
            capacityEl.value = '';
            surfaceEl.value = '';
            phoneEl.value = '';
            availEl.value = 'true';

            await loadStadiums();

        } catch (e) {
            errorMsg.textContent = '경기장 저장 중 오류: ' + e.message;
            console.error(e);
        } finally {
            btn.disabled = false;
        }
    }

    async function deleteStadium(id) {
        if (!confirm('정말 삭제할까요?')) return;
        try {
            const res = await fetch(API_BASE + '/' + id, { method: 'DELETE' });
            if (!res.ok) throw new Error('삭제 실패: ' + res.status);
            await loadStadiums();
        } catch (e) {
            alert('삭제 중 오류: ' + e.message);
            console.error(e);
        }
    }

    document.getElementById('saveBtn').addEventListener('click', saveStadium);
    window.addEventListener('load', loadStadiums);
</script>
</body>
</html>
